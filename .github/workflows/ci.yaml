name: CI

on:
  pull_request:
    paths:
      - "tile-creator/**"

concurrency:
  group: ci-${{ github.head_ref }}
  cancel-in-progress: true

jobs:
  check-version:
    name: Check version bump
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # tag v5.0.0
        with:
          fetch-depth: 0

      - name: Check version was bumped
        run: |
          if ! BASE_VERSION=$(git show origin/${{ github.base_ref }}:tile-creator/tile.json 2>/dev/null | jq -r '.version'); then
            echo "No tile.json on base branch yet â€” skipping version check."
            exit 0
          fi

          PR_VERSION=$(jq -r '.version' tile-creator/tile.json)

          echo "Base version: $BASE_VERSION"
          echo "PR version:   $PR_VERSION"

          if [ "$BASE_VERSION" = "$PR_VERSION" ]; then
            echo "::error::Version in tile.json was not updated. Bump the version before merging."
            exit 1
          fi

  lint-tile:
    name: Lint tile
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # tag v5.0.0

      - name: Lint tile
        run: npx @tessl/cli tile lint tile-creator

permissions:
  contents: read
